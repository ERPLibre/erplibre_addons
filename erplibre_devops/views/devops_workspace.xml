<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="view_devops_workspace_conf_form" model="ir.ui.view">
        <field name="name">devops.workspace form</field>
        <field name="model">devops.workspace</field>
        <field name="arch" type="xml">
            <form string="DevOps Workspace">
                <header>
                    <button
                        class="oe_highlight"
                        name="action_install_workspace"
                        string="Install"
                        type="object"
                        attrs="{'invisible': ['|', ('is_installed', '=', True), ('is_conflict_mode_exec', '=', True)]}"
                    />
                    <button
                        class="oe_highlight"
                        name="action_install_me_workspace"
                        string="Me"
                        type="object"
                        attrs="{'invisible': ['|', ('is_installed', '=', True), ('is_conflict_mode_exec', '=', True)]}"
                    />
                    <button
                        class="oe_highlight"
                        name="action_check"
                        string="Status"
                        type="object"
                        attrs="{'invisible': ['|', ('is_installed', '=', False), ('is_conflict_mode_exec', '=', True)]}"
                    />
                    <button
                        class="oe_highlight"
                        name="action_start"
                        string="Start"
                        type="object"
                        attrs="{'invisible': ['|', '|', ('is_installed', '=', False), ('is_running', '=', True), ('is_conflict_mode_exec', '=', True)]}"
                    />
                    <button
                        class="btn-success"
                        name="action_start"
                        string="Start"
                        type="object"
                        attrs="{'invisible': ['|', '|', ('is_installed', '=', False), ('is_running', '=', False), ('is_conflict_mode_exec', '=', True)]}"
                    />
                    <button
                        class="oe_highlight"
                        name="action_stop"
                        string="Stop"
                        type="object"
                        attrs="{'invisible': ['|', '|', ('is_installed', '=', False), ('is_running', '=', False), ('is_conflict_mode_exec', '=', True)]}"
                    />
                    <button
                        class="btn-success"
                        name="action_stop"
                        string="Stop"
                        type="object"
                        attrs="{'invisible': ['|', '|', ('is_installed', '=', False), ('is_running', '=', True), ('is_conflict_mode_exec', '=', True)]}"
                    />
                    <button
                        class="oe_highlight"
                        name="action_reboot"
                        string="Reboot"
                        type="object"
                        attrs="{'invisible': ['|', ('is_installed', '=', False), ('is_conflict_mode_exec', '=', True)]}"
                    />
                    <button
                        class="oe_highlight"
                        name="action_update"
                        string="Update"
                        type="object"
                        attrs="{'invisible': ['|', ('is_installed', '=', False), ('is_conflict_mode_exec', '=', True)]}"
                    />
                    <button
                        class="oe_highlight"
                        name="action_install_workspace"
                        string="Re-install"
                        type="object"
                        attrs="{'invisible': [('is_conflict_mode_exec', '=', True)]}"
                        groups="base.group_no_one"
                    />
                </header>
                <div
                    class="badge-pill badge-success float-right"
                    attrs="{'invisible': [('is_self_instance', '=', False)]}"
                >
                    Same instance
                </div>
                <div class="oe_title">
                    <h1>
                        <field name="name" />
                    </h1>
                </div>
                <div class="bg-danger" attrs="{'invisible': [('is_conflict_mode_exec', '=', False)]}">
                    <h3>Error:</h3>
                    Cannot support this execution mode with source mode 'docker'.
                </div>
                <group>
                    <group string="Basic">
                        <field name="system_id" />
                        <field name="folder" />
                        <field name="mode_source" attrs="{'readonly': [('is_installed', '=', True)]}" />
                        <field name="mode_exec" />
                        <field name="mode_environnement" />
                        <field name="mode_version_erplibre" />
                        <field name="mode_version_base" />
                        <field name="is_conflict_mode_exec" invisible="True" />
                        <field name="is_self_instance" invisible="True" />
                        <field name="is_installed" invisible="True" />
                        <field name="is_running" invisible="True" />
                        <field name="is_me" invisible="True" />
                    </group>
                    <group string="Execution">
                        <field name="is_debug_log" />
                        <field name="show_error_chatter" />
                        <field
                            name="exec_reboot_process"
                            attrs="{'invisible': ['|', ('mode_exec', '=', 'docker'), ('is_me', '=', False)]}"
                        />
                    </group>
                    <group string="Network" attrs="{'invisible': [('is_installed', '=', False)]}">
                        <button
                            class="oe_highlight"
                            name="action_network_change_port_random"
                            string="Random port"
                            type="object"
                            attrs="{'invisible': [('exec_reboot_process', '=', False)]}"
                        />
                        <button
                            class="oe_highlight"
                            name="action_network_change_port_default"
                            string="Default port"
                            type="object"
                            attrs="{'invisible': ['|', ('exec_reboot_process', '=', False), ('is_me', '=', False)]}"
                        />
                        <field name="port_http" attrs="{'readonly': [('exec_reboot_process', '=', False)]}" />
                        <field name="port_longpolling" attrs="{'readonly': [('exec_reboot_process', '=', False)]}" />
                    </group>
                    <group string="Git">
                        <field name="git_branch" />
                        <field name="git_url" />
                    </group>
                    <group string="Info" attrs="{'invisible': [('is_installed', '=', False)]}">
                        <field name="url_instance" widget="url" />
                        <field name="url_instance_database_manager" string="URL Instance Database" widget="url" />
                    </group>
                    <group string="DB" attrs="{'invisible': [('is_installed', '=', False)]}">
                        <button class="oe_highlight" name="action_restore_db_image" string="Restore" type="object" />
                        <field name="image_db_selection" />
                        <field name="db_name" />
                    </group>
                    <group string="Docker" attrs="{'invisible': [('is_installed', '=', False)]}">
                        <field name="workspace_docker_id" />
                    </group>
                    <group string="Action">
                        <button class="oe_highlight" name="action_open_terminal" string="Terminal" type="object" />
                        <button class="oe_highlight" name="action_clear_cache" string="Clear cache" type="object" />
                        <!--                            <button class="oe_highlight" name="action_open_terminal_docker" string="Terminal docker" type="object" />-->
                    </group>
                </group>

                <!--                <separator colspan="2" string="Help" />-->
                <!--                <div>-->
                <!--                    Automatic devops_workspaces of the database can be scheduled as follows:-->
                <!--                    <ol>-->
                <!--                        <li>Go to Settings / Technical / Automation / Scheduled Actions.</li>-->
                <!--                        <li>Search the action named 'devops_workspace scheduler'.</li>-->
                <!--                        <li>Set the scheduler to active and fill in how often you want devops_workspaces generated.</li>-->
                <!--                    </ol>-->
                <!--                </div>-->
                <notebook attrs="{'invisible': [('is_installed', '=', False)]}">
                    <!--                    <page name="docker" string="Docker">-->
                    <!--                        <group string="Action">-->
                    <!--                            <field name="docker_initiate_succeed" invisible="True" />-->
                    <!--                            <button class="oe_highlight" name="action_start_docker_compose" string="Run docker-compose" type="object" />-->
                    <!--                            <button class="oe_highlight" name="action_stop_docker_compose" string="Stop docker-compose" type="object" />-->
                    <!--                            <button class="oe_highlight" name="action_open_terminal_docker" string="Terminal docker" type="object" />-->
                    <!--                            <button class="oe_highlight" name="action_docker_restore_db_image" string="Restore DB Image" type="object" />-->
                    <!--                            <button class="oe_highlight" name="action_docker_logs" string="Docker logs" type="object" />-->
                    <!--                            <button class="oe_highlight" name="action_docker_install_dev_soft" string="Docker install dev" type="object" />-->
                    <!--                            <button class="btn-danger" name="action_os_user_permission_docker" string="Give docker permission" type="object" attrs="{'invisible': [('docker_initiate_succeed', '=', True)]}"/>-->

                    <!--&lt;!&ndash;                            <button  type="action" context="{'default_workcenter_id': workcenter_id}" string="Block" class="btn-danger" attrs="{'invisible': ['|', '|', ('working_state', '=', 'blocked'), ('state', 'in', ('done', 'pending', 'ready', 'cancel')), ('is_user_working', '=', False)]}"/>&ndash;&gt;-->

                    <!--                            <button class="oe_highlight" name="action_analyse_docker_image" string="Analyse docker image" type="object" />-->
                    <!--                        </group>-->
                    <!--                        <group>-->
                    <!--                            <group string="Status instance">-->
                    <!--                                <field name="docker_is_running"/>-->
                    <!--                                <field name="db_is_restored"/>-->
                    <!--                            </group>-->
                    <!--                        </group>-->
                    <!--                        <group string="Configuration">-->
                    <!--                            <group>-->
                    <!--                                <field name="force_create_docker_compose" />-->
                    <!--                                <field name="docker_version"/>-->
                    <!--                                <field name="docker_cmd_extra"/>-->
                    <!--                                <field name="docker_nb_proc"/>-->
                    <!--                                <field name="docker_is_behind_proxy"/>-->
                    <!--                                <field name="docker_config_gen_cg"/>-->
                    <!--                            </group>-->
                    <!--                        </group>-->
                    <!--                        <group string="Log">-->
                    <!--                            <field name="docker_compose_ps" />-->
                    <!--                        </group>-->
                    <!--                    </page>-->
                    <page name="status" string="Status">
                        <group string="Instance">
                            <!--                            <field name="docker_is_running"/>-->
                            <field name="db_is_restored" />
                            <field name="has_error_restore_db" />
                        </group>
                    </page>
                    <page name="code_generator" string="Code">
                        <group string="Action CG">
                            <group>
                                <button
                                    class="oe_highlight"
                                    name="action_install_and_generate_all_generated_module"
                                    string="All"
                                    type="object"
                                />
                                <div
                                    attrs="{'invisible': [('time_exec_action_install_and_generate_all_generated_module', '=', False)]}"
                                >
                                    Exec in
                                    <field
                                        name="time_exec_action_install_and_generate_all_generated_module"
                                        nolabel="1"
                                    />
                                </div>
                            </group>
                            <group>
                                <button
                                    class="oe_highlight"
                                    name="action_code_generator_generate_all"
                                    string="Generate all"
                                    type="object"
                                />
                                <div
                                    attrs="{'invisible': [('time_exec_action_code_generator_generate_all', '=', False)]}"
                                >
                                    Exec in
                                    <field name="time_exec_action_code_generator_generate_all" nolabel="1" />
                                </div>
                            </group>
                            <group>
                                <button
                                    class="oe_highlight"
                                    name="action_install_all_generated_module"
                                    string="Install all"
                                    type="object"
                                />
                                <div
                                    attrs="{'invisible': [('time_exec_action_install_all_generated_module', '=', False)]}"
                                >
                                    Exec in
                                    <field name="time_exec_action_install_all_generated_module" nolabel="1" />
                                </div>
                            </group>
                            <group>
                                <button
                                    class="oe_highlight"
                                    name="action_refresh_meta_cg_generated_module"
                                    string="Refresh CG"
                                    type="object"
                                />
                                <div
                                    attrs="{'invisible': [('time_exec_action_refresh_meta_cg_generated_module', '=', False)]}"
                                >
                                    Exec in
                                    <field name="time_exec_action_refresh_meta_cg_generated_module" nolabel="1" />
                                </div>
                            </group>
                            <group>
                                <button
                                    class="oe_highlight"
                                    name="action_install_all_uca_generated_module"
                                    string="Install UCA"
                                    type="object"
                                />
                                <div
                                    attrs="{'invisible': [('time_exec_action_install_all_uca_generated_module', '=', False)]}"
                                >
                                    Exec in
                                    <field name="time_exec_action_install_all_uca_generated_module" nolabel="1" />
                                </div>
                            </group>
                            <group>
                                <button
                                    class="oe_highlight"
                                    name="action_install_all_ucb_generated_module"
                                    string="Install UCB"
                                    type="object"
                                />
                                <div
                                    attrs="{'invisible': [('time_exec_action_install_all_ucb_generated_module', '=', False)]}"
                                >
                                    Exec in
                                    <field name="time_exec_action_install_all_ucb_generated_module" nolabel="1" />
                                </div>
                            </group>
                        </group>
                        <group string="Action addons">
                            <group>
                                <button
                                    class="oe_highlight"
                                    name="action_clear_all_generated_module"
                                    string="Clear all"
                                    type="object"
                                />
                                <div
                                    attrs="{'invisible': [('time_exec_action_clear_all_generated_module', '=', False)]}"
                                >
                                    Exec in
                                    <field name="time_exec_action_clear_all_generated_module" nolabel="1" />
                                </div>
                            </group>
                            <group>
                                <button
                                    class="oe_highlight"
                                    name="action_git_commit_all_generated_module"
                                    string="Git commit"
                                    type="object"
                                />
                                <div
                                    attrs="{'invisible': [('time_exec_action_git_commit_all_generated_module', '=', False)]}"
                                >
                                    Exec in
                                    <field name="time_exec_action_git_commit_all_generated_module" nolabel="1" />
                                </div>
                            </group>
                            <group>
                                <button
                                    class="oe_highlight"
                                    name="action_open_terminal_tig"
                                    string="Terminal tig"
                                    type="object"
                                />
                            </group>
                            <group>
                                <button
                                    class="oe_highlight"
                                    name="action_open_terminal_addons"
                                    string="Terminal addons"
                                    type="object"
                                />
                            </group>
                        </group>
                        <group string="Action other">
                            <group>
                                <button
                                    class="oe_highlight"
                                    name="action_cg_generate_demo"
                                    string="Generate demo"
                                    type="object"
                                />
                                <field name="is_clear_before_cg_demo" />
                                <field name="cg_demo_type_data" />
                            </group>
                        </group>
                        <group string="Execution">
                            <field name="last_new_project_cg" />
                        </group>
                        <group string="Configuration">
                            <field name="path_code_generator_to_generate" />
                            <field name="path_working_erplibre" />
                        </group>
                        <group string="Generator">
                            <field name="id" invisible="True" />
                            <field
                                name="devops_code_generator_ids"
                                widget="many2many"
                                context="{'default_devops_workspace_ids': [id]}"
                                options="{'always_reload': True}"
                            />
                            <field
                                name="devops_code_generator_module_ids"
                                widget="many2many"
                                context="{'default_devops_workspace_ids': [id]}"
                                options="{'always_reload': True}"
                            />
                            <field
                                name="devops_code_generator_model_ids"
                                widget="many2many"
                                context="{'default_devops_workspace_ids': [id]}"
                                options="{'always_reload': True}"
                            />
                            <field
                                name="devops_code_generator_field_ids"
                                widget="many2many"
                                context="{'default_devops_workspace_ids': [id]}"
                                options="{'always_reload': True}"
                            />
                        </group>
                    </page>
                    <page name="code_generator_misc" string="CG">
                        <div class="bg-warning">
                            <h3>Warning:</h3>
                            Create new project with code generator
                        </div>
                        <group string="CG new project">
                            <group>
                                <field name="need_debugger_cg_erplibre_devops" invisible="True" />
                                <button
                                    class="oe_highlight"
                                    name="action_cg_erplibre_devops"
                                    string="ERPLibre DevOps"
                                    type="object"
                                />
                                <div attrs="{'invisible': [('time_exec_action_cg_erplibre_devops', '=', False)]}">
                                    Exec in
                                    <field name="time_exec_action_cg_erplibre_devops" nolabel="1" />
                                </div>
                                <div attrs="{'invisible': [('need_debugger_cg_erplibre_devops', '=', False)]}">
                                    <button
                                        class="oe_highlight"
                                        name="action_cg_setup_pycharm_debug"
                                        string="Setup Pycharm debug"
                                        type="object"
                                    />
                                </div>
                                <button
                                    class="oe_highlight"
                                    name="action_open_terminal_path_erplibre_devops"
                                    string="Terminal path erplibre_devops"
                                    type="object"
                                />
                                <button
                                    class="oe_highlight"
                                    name="action_format_erplibre_devops"
                                    string="Format module erplibre_devops"
                                    type="object"
                                />
                                <button
                                    class="oe_highlight"
                                    name="action_update_erplibre_devops"
                                    string="Update module erplibre_devops"
                                    type="object"
                                />
                                <button
                                    class="oe_highlight"
                                    name="workspace_CG_remove_module"
                                    string="Clear modules"
                                    type="object"
                                />
                                <button
                                    class="oe_highlight"
                                    name="workspace_CG_git_commit"
                                    string="Git commit"
                                    type="object"
                                />
                            </group>
                            <group>
                                <field name="stop_execution_if_env_not_clean" />
                            </group>
                        </group>
                        <group string="Execution">
                            <field name="last_new_project_self" />
                        </group>
                        <group string="Log">
                            <field
                                name="devops_cg_erplibre_devops_error_log"
                                attrs="{'invisible': [('devops_cg_erplibre_devops_error_log', '=', False)]}"
                            />
                            <field name="devops_cg_erplibre_devops_log" />
                        </group>
                    </page>
                    <page name="code_generator_info_diff" string="Diff">
                        <field name="devops_code_generator_diff" />
                    </page>
                    <page name="code_generator_info_status" string="Status">
                        <field name="devops_code_generator_status" />
                    </page>
                    <page name="code_generator_info_stat" string="Stat">
                        <field name="devops_code_generator_stat" />
                    </page>
                    <page name="code_generator_info_tree" string="Tree">
                        <group>
                            <button
                                class="oe_highlight"
                                name="action_check_tree_addons"
                                string="Update tree"
                                type="object"
                            />
                        </group>
                        <field name="devops_code_generator_tree_addons" />
                    </page>
                    <page name="log" string="Log">
                        <group>
                            <field name="log_workspace" />
                        </group>
                        <group>
                            <field name="devops_code_generator_log_addons" />
                        </group>
                    </page>
                    <page name="install" string="Install">
                        <group>
                            <group>
                                <button
                                    class="oe_highlight"
                                    name="action_poetry_install"
                                    string="Poetry install"
                                    type="object"
                                />
                            </group>
                        </group>
                    </page>
                    <page name="test" string="Test">
                        <group>
                            <group>
                                <field name="test_ids" />
                            </group>
                        </group>
                    </page>
                    <page name="exec" string="Execution">
                        <field name="devops_exec_ids" />
                    </page>
                    <page name="exec_bundle" string="Bundle exec">
                        <field name="devops_exec_bundle_root_ids" />
                    </page>
                    <page name="exec_error" string="Error exec">
                        <field name="devops_exec_error_ids" />
                    </page>
                </notebook>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers" />
                    <field name="activity_ids" widget="mail_activity" />
                    <field name="message_ids" widget="mail_thread" />
                </div>
            </form>
        </field>
    </record>

    <record id="view_devops_workspace_conf_search" model="ir.ui.view">
        <field name="name">devops.workspace search</field>
        <field name="model">devops.workspace</field>
        <field name="arch" type="xml">
            <search>
                <field name="name" />
                <field name="folder" />
            </search>
        </field>
    </record>

    <record id="view_devops_workspace_conf_tree" model="ir.ui.view">
        <field name="name">devops.workspace tree</field>
        <field name="model">devops.workspace</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name" />
                <field name="folder" />
                <field name="system_id" />
                <field name="mode_source" />
                <field name="mode_exec" />
                <field name="mode_environnement" />
                <field name="mode_version_erplibre" />
                <field name="mode_version_base" />
                <field name="is_installed" />
            </tree>
        </field>
    </record>

    <act_window
        id="action_devops_check_workspace_conf_form"
        name="Automated devops_workspaces"
        res_model="devops.workspace"
    />

    <!-- Execute devops_workspace from "More" menu -->
    <record id="action_server_devops_workspace_start" model="ir.actions.server">
        <field name="name">Start workspace(s)</field>
        <field name="model_id" ref="model_devops_workspace" />
        <field name="binding_model_id" ref="model_devops_workspace" />
        <field name="state">code</field>
        <field name="code">records.action_start()</field>
    </record>

    <record id="action_server_devops_workspace_stop" model="ir.actions.server">
        <field name="name">Stop workspace(s)</field>
        <field name="model_id" ref="model_devops_workspace" />
        <field name="binding_model_id" ref="model_devops_workspace" />
        <field name="state">code</field>
        <field name="code">records.action_stop()</field>
    </record>

    <record id="action_server_devops_workspace_reboot" model="ir.actions.server">
        <field name="name">Reboot workspace(s)</field>
        <field name="model_id" ref="model_devops_workspace" />
        <field name="binding_model_id" ref="model_devops_workspace" />
        <field name="state">code</field>
        <field name="code">records.action_reboot()</field>
    </record>

    <record id="action_server_devops_workspace_check" model="ir.actions.server">
        <field name="name">Check workspace(s)</field>
        <field name="model_id" ref="model_devops_workspace" />
        <field name="binding_model_id" ref="model_devops_workspace" />
        <field name="state">code</field>
        <field name="code">records.action_check()</field>
    </record>

    <record id="action_server_devops_workspace_open_terminal_folder" model="ir.actions.server">
        <field name="name">Open terminal folder workspace(s)</field>
        <field name="model_id" ref="model_devops_workspace" />
        <field name="binding_model_id" ref="model_devops_workspace" />
        <field name="state">code</field>
        <field name="code">records.action_open_terminal()</field>
    </record>
</odoo>
