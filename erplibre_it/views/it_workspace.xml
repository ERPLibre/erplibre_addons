<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_it_workspace_conf_form" model="ir.ui.view">
        <field name="name">it.workspace form</field>
        <field name="model">it.workspace</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button class="oe_highlight" name="action_install_workspace" string="Install" type="object" attrs="{'invisible': [('is_installed', '=', True)]}" />
                    <button class="oe_highlight" name="action_it_check_all" string="Status check" type="object" attrs="{'invisible': [('is_installed', '=', False)]}" />
                </header>
                <div class="badge-pill badge-success float-right" attrs="{'invisible': [('is_self_instance', '=', False)]}">Same instance</div>
                <div class="oe_title">
                    <h1>
                        <field name="name" />
                    </h1>
                </div>
                <group>
                    <group string="Basic">
                        <field name="system_id" />
                        <field name="folder" />
                        <field name="mode_exec" />
                        <field name="mode_environnement" />
                        <field name="mode_version_erplibre" />
                        <field name="mode_version_base" />
                        <field name="is_self_instance" invisible="True"/>
                        <field name="is_installed" invisible="True"/>
                    </group>
                    <group string="Network" attrs="{'invisible': [('is_installed', '=', False)]}">
                        <button class="oe_highlight" name="action_network_change_port_random" string="Random port" type="object" />
                        <field name="port_http" />
                        <field name="port_longpolling" />
                    </group>
                    <group string="Git">
                        <field name="git_branch" />
                        <field name="git_url" />
                    </group>
                    <group string="Info" attrs="{'invisible': [('is_installed', '=', False)]}">
                        <field name="url_instance" widget="url"/>
                        <field name="url_instance_database_manager" string="URL Instance Database" widget="url"/>
                    </group>
                    <group string="DB" attrs="{'invisible': [('is_installed', '=', False)]}">
                        <field name="image_db_selection"/>
                        <field name="db_name"/>
                    </group>
                </group>

<!--                <separator colspan="2" string="Help" />-->
<!--                <div>-->
<!--                    Automatic it_workspaces of the database can be scheduled as follows:-->
<!--                    <ol>-->
<!--                        <li>Go to Settings / Technical / Automation / Scheduled Actions.</li>-->
<!--                        <li>Search the action named 'it_workspace scheduler'.</li>-->
<!--                        <li>Set the scheduler to active and fill in how often you want it_workspaces generated.</li>-->
<!--                    </ol>-->
<!--                </div>-->
                <notebook attrs="{'invisible': [('is_installed', '=', False)]}">
                    <page name="docker" string="Docker">
                        <group string="Action">
                            <field name="docker_initiate_succeed" invisible="True" />
                            <button class="oe_highlight" name="action_start_docker_compose" string="Run docker-compose" type="object" />
                            <button class="oe_highlight" name="action_stop_docker_compose" string="Stop docker-compose" type="object" />
                            <button class="oe_highlight" name="action_open_terminal_docker" string="Terminal docker" type="object" />
                            <button class="oe_highlight" name="action_docker_restore_db_image" string="Restore DB Image" type="object" />
                            <button class="oe_highlight" name="action_docker_logs" string="Docker logs" type="object" />
                            <button class="oe_highlight" name="action_docker_install_dev_soft" string="Docker install dev" type="object" />
                            <button class="btn-danger" name="action_os_user_permission_docker" string="Give docker permission" type="object" attrs="{'invisible': [('docker_initiate_succeed', '=', True)]}"/>

<!--                            <button  type="action" context="{'default_workcenter_id': workcenter_id}" string="Block" class="btn-danger" attrs="{'invisible': ['|', '|', ('working_state', '=', 'blocked'), ('state', 'in', ('done', 'pending', 'ready', 'cancel')), ('is_user_working', '=', False)]}"/>-->

                            <button class="oe_highlight" name="action_analyse_docker_image" string="Analyse docker image" type="object" />
                        </group>
                        <group>
                            <group string="Status instance">
                                <field name="docker_is_running"/>
                                <field name="db_is_restored"/>
                            </group>
                        </group>
                        <group string="Configuration">
                            <group>
                                <field name="force_create_docker_compose" />
                                <field name="docker_version"/>
                                <field name="docker_cmd_extra"/>
                                <field name="docker_nb_proc"/>
                                <field name="docker_is_behind_proxy"/>
                                <field name="docker_config_gen_cg"/>
                            </group>
                        </group>
                        <group string="Log">
                            <field name="docker_compose_ps" />
                        </group>
                    </page>
                    <page name="status" string="Status">
                        <group string="Instance">
                            <field name="docker_is_running"/>
                            <field name="db_is_restored"/>
                        </group>
                    </page>
                    <page name="code_generator" string="Code">
                        <group string="Action">
                            <group>
                                <button class="oe_highlight" name="action_install_and_generate_all_generated_module" string="All" type="object" />
                                <div attrs="{'invisible': [('time_exec_action_install_and_generate_all_generated_module', '=', False)]}">Exec in <field name="time_exec_action_install_and_generate_all_generated_module" nolabel="1"/></div>
                            </group>
                            <group>
                                <button class="oe_highlight" name="action_code_generator_generate_all" string="Generate all" type="object" />
                                <div attrs="{'invisible': [('time_exec_action_code_generator_generate_all', '=', False)]}">Exec in <field name="time_exec_action_code_generator_generate_all" nolabel="1"/></div>
                            </group>
                            <group>
                                <button class="oe_highlight" name="action_install_all_generated_module" string="Install all" type="object" />
                                <div attrs="{'invisible': [('time_exec_action_install_all_generated_module', '=', False)]}">Exec in <field name="time_exec_action_install_all_generated_module" nolabel="1"/></div>
                            </group>
                            <group>
                                <button class="oe_highlight" name="action_refresh_meta_cg_generated_module" string="Refresh CG" type="object" />
                                <div attrs="{'invisible': [('time_exec_action_refresh_meta_cg_generated_module', '=', False)]}">Exec in <field name="time_exec_action_refresh_meta_cg_generated_module" nolabel="1"/></div>
                            </group>
                            <group>
                                <button class="oe_highlight" name="action_install_all_uca_generated_module" string="Install UCA" type="object" />
                                <div attrs="{'invisible': [('time_exec_action_install_all_uca_generated_module', '=', False)]}">Exec in <field name="time_exec_action_install_all_uca_generated_module" nolabel="1"/></div>
                            </group>
                            <group>
                                <button class="oe_highlight" name="action_install_all_ucb_generated_module" string="Install UCB" type="object" />
                                <div attrs="{'invisible': [('time_exec_action_install_all_ucb_generated_module', '=', False)]}">Exec in <field name="time_exec_action_install_all_ucb_generated_module" nolabel="1"/></div>
                            </group>
                            <group>
                                <button class="oe_highlight" name="action_clear_all_generated_module" string="Clear all" type="object" />
                                <div attrs="{'invisible': [('time_exec_action_clear_all_generated_module', '=', False)]}">Exec in <field name="time_exec_action_clear_all_generated_module" nolabel="1"/></div>
                            </group>
                            <group>
                                <button class="oe_highlight" name="action_git_commit_all_generated_module" string="Git commit" type="object" />
                                <div attrs="{'invisible': [('time_exec_action_git_commit_all_generated_module', '=', False)]}">Exec in <field name="time_exec_action_git_commit_all_generated_module" nolabel="1"/></div>
                            </group>
                            <group>
                                <button class="oe_highlight" name="action_open_terminal_tig" string="Terminal tig" type="object" />
                            </group>
                        </group>
                        <group string="Configuration">
                            <field name="path_code_generator_to_generate"/>
                            <field name="path_working_erplibre"/>
                        </group>
                        <group string="Generator">
                            <field name="id" invisible="True"/>
                            <field name="it_code_generator_ids" widget="many2many" context="{'default_it_workspace_ids': [id]}"/>
                            <field name="it_code_generator_module_ids" widget="many2many" context="{'default_it_workspace_ids': [id]}"/>
                            <field name="it_code_generator_model_ids" widget="many2many" context="{'default_it_workspace_ids': [id]}"/>
                            <field name="it_code_generator_field_ids" widget="many2many" context="{'default_it_workspace_ids': [id]}"/>
                        </group>
                    </page>
                    <page name="code_generator_misc" string="CG">
                        <div class="bg-warning">
                            <h3>Warning:</h3>
                            Create new project with code generator
                        </div>
                        <group string="CG new project">
                            <group>
                                <button class="oe_highlight" name="action_cg_erplibre_it" string="ERPLibre IT" type="object" />
                                <div attrs="{'invisible': [('time_exec_action_cg_erplibre_it', '=', False)]}">Exec in <field name="time_exec_action_cg_erplibre_it" nolabel="1"/></div>
                            </group>
                        </group>
                    </page>
                    <page name="code_generator_info_diff" string="Diff">
                        <field name="it_code_generator_diff"/>
                    </page>
                    <page name="code_generator_info_status" string="Status">
                        <field name="it_code_generator_status"/>
                    </page>
                    <page name="code_generator_info_stat" string="Stat">
                        <field name="it_code_generator_stat"/>
                    </page>
                    <page name="code_generator_info_tree" string="Tree">
                        <group>
                            <button class="oe_highlight" name="action_docker_check_docker_tree_addons" string="Update tree" type="object" />
                        </group>
                        <field name="it_code_generator_tree_addons"/>
                    </page>
                    <page name="log" string="Log">
                        <group string="Action">
                            <button class="oe_highlight" name="action_open_terminal" string="Terminal" type="object" />
                            <button class="oe_highlight" name="action_open_terminal_docker" string="Terminal docker" type="object" />
                        </group>
                        <group>
                            <field name="log_workspace" />
                        </group>
                        <group>
                            <field name="it_code_generator_log_addons"/>
                        </group>
                    </page>
                </notebook>
            </form>
        </field>
    </record>

    <record id="view_it_workspace_conf_search" model="ir.ui.view">
        <field name="name">it.workspace search</field>
        <field name="model">it.workspace</field>
        <field name="arch" type="xml">
            <search>
                <field name="name" />
                <field name="folder" />
            </search>
        </field>
    </record>

    <record id="view_it_workspace_conf_tree" model="ir.ui.view">
        <field name="name">it.workspace tree</field>
        <field name="model">it.workspace</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name" />
                <field name="folder" />
                <field name="system_id" />
                <field name="mode_exec" />
                <field name="mode_environnement" />
                <field name="mode_version_erplibre" />
                <field name="mode_version_base" />
                <field name="is_installed"/>
            </tree>
        </field>
    </record>

    <act_window id="action_it_check_workspace_conf_form" name="Automated it_workspaces" res_model="it.workspace" />

    <!-- Execute it_workspace from "More" menu -->
    <record id="action_server_it_workspace" model="ir.actions.server">
        <field name="name">Execute it_workspace(s)</field>
        <field name="model_id" ref="model_it_workspace"/>
        <field name="binding_model_id" ref="model_it_workspace"/>
        <field name="state">code</field>
        <field name="code">records.action_start_docker_compose()</field>
    </record>

</odoo>
